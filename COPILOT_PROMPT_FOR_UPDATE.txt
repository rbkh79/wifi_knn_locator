/*
Prompt for GitHub Copilot: Update Flutter App for Indoor Wi-Fi Localization with KNN

Current App Details from README_FA.md:
- Flutter mobile app for indoor localization using Wi-Fi scans (RSSI + MAC) and KNN algorithm.
- Features: Periodic AP scanning (BSSID, RSSI, frequency, SSID); SHA-256 MAC hashing for privacy; Offline SQLite DB for fingerprints; KNN for position estimation with confidence score; Training mode for data collection; User-friendly UI with privacy info; Unit tests.
- Modular structure: lib/config.dart (K=3, scanInterval=5s), data_model.dart (WifiReading, FingerprintEntry, LocationEstimate), wifi_scanner.dart, local_database.dart, knn_localization.dart, main.dart, services/fingerprint_service.dart, utils/privacy_utils.dart.
- KNN Pseudocode: Load fingerprints, calculate Euclidean distance (default -100 dBm for missing BSSID), sort distances, select K nearest, weighted average for lat/lon, confidence = 1 / (1 + avgDistance / 100).
- DB Structure: fingerprints table (id, fingerprint_id, latitude, longitude, zone_label, created_at, device_id); access_points table (id, fingerprint_id, bssid, rssi, frequency, ssid).
- Permissions: Android ACCESS_FINE_LOCATION, etc.; iOS NSLocationWhenInUseUsageDescription.

Goal: Enhance the app to predict future position and user path based on historical Wi-Fi data (MAC/RSSI), even during Wi-Fi outages (signal cuts). Use historical data from SQLite to extrapolate paths. Add innovative features not commonly used in similar apps (up to 2025 literature).

Improvement Ideas to Implement:
1. Integrate Temporal Graph Attention Networks (TGAT) for modeling MAC relations as a temporal graph and predicting paths. Use PyTorch via flutter_torch plugin. Build graph from historical RSSI changes; predict next node (position) in knn_localization.dart.
2. Add Uncertainty-Aware Prediction with Bayesian Neural Networks (BNN) to compute prediction uncertainty. In UI, show confidence bar; during outages, warn if uncertainty high.
3. Implement Federated Learning for local model training (e.g., small LSTM) on user data without sharing raw data. Use Firebase backend to aggregate models; keep data local in SQLite.
4. Add Graph-Based Extrapolation with Temporal Graph Neural Networks (TGNN) for path prediction during outages. Detect outage (RSSI=0 threshold), extrapolate from last historical path.
5. Uncertainty-Guided Prediction with Variational Autoencoders (VAE) for handling outages: Train VAE on historical RSSI to generate probable paths; display in map UI.
6. Offline Trajectory Forecasting with Offline Reinforcement Learning (Offline RL, e.g., CQL). Model paths as action-reward sequences; predict long-term paths offline during outages.

Tasks for Copilot:
- Generate Dart code to add these features. Start with new files/modules if needed (e.g., prediction_service.dart for ML models).
- Integrate with existing: Update wifi_scanner.dart for outage detection; local_database.dart for historical data queries; knn_localization.dart for hybrid KNN + new models.
- Use torch for ML (assume flutter_torch installed); add pubspec.yaml dependencies if needed.
- Update UI in main.dart: Add path prediction display on map, outage mode switch.
- Update README_FA.md with new features, architecture, and pseudocode.
- Ensure privacy: Hash all data; no central sharing except federated gradients.
- Make it novel: These combos (e.g., TGNN for Wi-Fi outage prediction) are unpublished in 2025 literature.

Generate the updated code starting from here:
*/
